<!DOCTYPE html>
<html>
<head>
    <title>BLE Attendance - Teacher</title>
    <script src="bluetooth_advertiser.js"></script>
</head>
<body>
    <h1>Teacher - BLE Class Broadcasting</h1>
    
    <div id="session-info">
        <h3>Current Session:</h3>
        <p>Course: <span id="course-name">ML-Class</span></p>
        <p>Location: <span id="classroom">B4-104</span></p>
        <p>Session ID: <span id="session-id">d607f0d8-d737-4a32-bd11-7b66f7c9474b</span></p>
    </div>
    
    <button id="start-ble" onclick="startBLEAdvertising()">Start BLE Broadcasting</button>
    <button id="stop-ble" onclick="stopBLEAdvertising()" disabled>Stop Broadcasting</button>
    
    <div id="status"></div>
    <div id="current-token"></div>
    
    <script>
        async function startBLEAdvertising() {
            const sessionData = {
                session_id: document.getElementById('session-id').textContent,
                course_name: document.getElementById('course-name').textContent,
                classroom_location: document.getElementById('classroom').textContent
            };
            
            try {
                await startClassBLEAdvertising(sessionData);
                
                document.getElementById('start-ble').disabled = true;
                document.getElementById('stop-ble').disabled = false;
                document.getElementById('status').innerHTML = '<p style="color: green;">✅ BLE Broadcasting Active</p>';
                
                // Show current token updates
                updateTokenDisplay();
                
            } catch (error) {
                document.getElementById('status').innerHTML = '<p style="color: red;">❌ Failed to start BLE: ' + error.message + '</p>';
            }
        }
        
        function stopBLEAdvertising() {
            stopClassBLEAdvertising();
            
            document.getElementById('start-ble').disabled = false;
            document.getElementById('stop-ble').disabled = true;
            document.getElementById('status').innerHTML = '<p style="color: orange;">⏸️ BLE Broadcasting Stopped</p>';
        }
        
        function updateTokenDisplay() {
            const tokenDisplay = document.getElementById('current-token');
            
            setInterval(() => {
                if (window.currentBLEAdvertiser) {
                    const currentToken = window.currentBLEAdvertiser.generateCurrentToken();
                    tokenDisplay.innerHTML = `<p><strong>Current BLE Token:</strong> ${currentToken}</p>`;
                }
            }, 1000);
        }
    </script>
</body>
</html>